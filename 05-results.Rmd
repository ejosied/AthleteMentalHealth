# Results

```{r, echo=FALSE} 
library(tidyverse)
library(magrittr)
library(dplyr)
library(vcd)
library(RColorBrewer)
library(ggplot2)
library(gridExtra)
library(cowplot)
library(ggcorrplot)
``` 

```{r}
#load dataset
load("~/Documents/MSDS/EDAV/Final Project Data/DS0001/33661-0001-Data.rda")
df <- da33661.0001
```

```{r}
# define function to indicate whether or not a student has indicated that they have done a sport
is_marked <- function(x) x == "(1) Marked"
```

```{r}
get_indicators <- function(s){
  
  sports <- c("Boxing", "Baseball", "Basketball", "Bowling", "Cheerleading", "Cross Country", "Dance", "Field Hockey", "Football", "Golf", "Gymnastics", "Ice Hockey", "Lacross", "Rugby", "Skiing", "Soccer", "Swimming", "Tennis", "Track", "Volleyball", "Wrestling")
  sport_codes <- c("BX", "BB", "BK", "BL", "CH", "CC", "DN", "FH", "FB", "GF", "GM", "IH", "LC", "RG", "SK", "SC", "SB", "SW", "TN", "TF", "VB", "WR")
  
  index <- match(s, sports)
  sport_code <- sport_codes[index]
  
  prefixes <- c("TSFR", "TSSO", "TSJR", "TSSE", "TCFR", "TCSO", "TCJR", "TCSE", "TPCL", "TPCM")
  indic <- c()
  for(p in prefixes){
    indic <- c(indic, paste(p, sport_code, sep=""))
  }
  
  return(indic)
}
```

```{r}
df_recoded <- function(data, v) {
  
  positive_mh <- c("CESD05", "CESD08")
  negative_mh <- c("CESD01", "CESD02", "CESD03", "CESD04", "CESD06", "CESD07", "CESD09", "CESD10")
  
  motivation_int <- c("MPSQ01", "MPSQ02", "MPSQ03", "MPSQ06", "MPSQ09", "MPSQ11", "MPSQ14", "MPSQ17", "MPSQ20", "MPSQ21", "MPSQ22", "MPSQ23", "MPSQ25")
  motivation_ext <- c("MPSQ04", "MPSQ05", "MPSQ07", "MPSQ08", "MPSQ10", "MPSQ12", "MPSQ13", "MPSQ15", "MPSQ16", "MPSQ18", "MPSQ19", "MPSQ24")
  
  success_hardwork <- c("TEOSQ02", "TEOSQ05", "TEOSQ07", "TEOSQ08", "TEOSQ10", "TEOSQ13")
  success_ego <- c("TEOSQ01", "TEOSQ03", "TEOSQ04", "TEOSQ06", "TEOSQ09", "TEOSQ11", "TEOSQ12")
  
  behavior_cautious <- c("GENRIS02", "GENRIS03", "GENRIS07", "GENRIS09", "GENRIS10", "GENRIS12", "GENRIS13", "GENRIS14", "GENRIS17", "GENRIS18")
  behavior_risky <- c("GENRIS01", "GENRIS04", "GENRIS05", "GENRIS06", "GENRIS08", "GENRIS11", "GENRIS15", "GENRIS16")
  
  if(startsWith(v, "CESD")){
    if(v %in% positive_mh){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(.,`-2` = "(1) Rarely or none of the time (less than 1 day)", `-1` = "(2) Some or a little of the time (1-2 days)", `1` = "(3) Occasionally or a moderate amount of time (3-4 days)", `2` = "(4) All of the time (5-7 days)")))
    }
    else if(v %in% negative_mh){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(.,`2` = "(1) Rarely or none of the time (less than 1 day)", `1` = "(2) Some or a little of the time (1-2 days)", `-1` = "(3) Occasionally or a moderate amount of time (3-4 days)", `-2` = "(4) All of the time (5-7 days)")))
    }
  }
  
  else if(startsWith(v, "MPSQ")){
    if(v %in% motivation_int){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `-2` = "(1) Not Important at All", `-1` = "(2) Not Very Important", `0` = "(3) Somewhat Important", `1` = "(4) Pretty Important", `2` = "(5) Extremely Important")))
    }
    else if(v %in% motivation_ext){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `2` = "(1) Not Important at All", `1` = "(2) Not Very Important", `0` = "(3) Somewhat Important", `-1` = "(4) Pretty Important", `-2` = "(5) Extremely Important")))
    }
  }
  
  else if(startsWith(v, "TEOSQ")){
    if(v %in% success_hardwork){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `-2` = "(1) Doesn't Describe Me At All", `-1` = "(2) Describes Me a Little", `0` = "(3) Describes Me Somewhat", `1` = "(4) Describes Me Pretty Well", `2` = "(5) Describes Me Extremely Well")))
    }
    else if(v %in% success_ego){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `2` = "(1) Doesn't Describe Me At All", `1` = "(2) Describes Me a Little", `0` = "(3) Describes Me Somewhat", `-1` = "(4) Describes Me Pretty Well", `-2` = "(5) Describes Me Extremely Well")))
    }
  }
  
  else if(startsWith(v, "GENRI")){
    if(v %in% behavior_cautious){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `-2` = "(1) Strongly Disagree", `-1` = "(2) Disagree", `1` = "(3) Agree", `2` = "(4) Strongly Agree")))
    }
    else if(v %in% behavior_risky){
      data <- data %>%
        mutate_at(c(v), funs(fct_recode(., `2` = "(1) Strongly Disagree", `1` = "(2) Disagree", `-1` = "(3) Agree", `-2` = "(4) Strongly Agree")))
    }
  }

  
  # if(v %in% negative_mh || v %in% motivation_ext || v %in% success_ego){
  #   data <- data %>%
  #     mutate_at(c(v), funs(as.factor(-1 * as.numeric(.))))
  # }
  
  
  else if(startsWith(v, "PSPORT")){
    data <- data %>%
      mutate_at(c(v), funs(fct_recode(.,
          `Badminton` = "(01) Badminton",                          
          `Baseball` = "(02) Baseball",
          `Basketball` = "(03) Basketball",
          `Bowling` = "(04) Bowling",
          `Boxing` = "(05) Boxing / Martial arts",
          `Cheerleading` = "(06) Cheer / Spirit",
          `Cross Country` = "(07) Cross country",
          `Dance` = "(08) Dance team",
          `Equestrian` = "(09) Equestrian",
          `Field Hockey` = "(11) Field hockey",
          `Figure Skating` = "(12) Figure skating",
          `Football` = "(13) Football",
          `Golf` = "(14) Golf",
          `Gymnastics` = "(15) Gymnastics",
          `Ice Hockey` = "(16) Ice hockey / Roller hockey",
          `Lacrosse` = "(17) Lacrosse",
          `Rugby` = "(18) Rugby",
          `Skiing` = "(19) Skiing",
          `Soccer` = "(20) Soccer",
          `Softball` = "(21) Softball",
          `Swimming` = "(22) Swimming / Diving",
          `Tennis` = "(23) Tennis / Racquetball",
          `Track` = "(24) Track and field",
          `Volleyball` = "(25) Volleyball",
          `Wrestling` = "(26) Wrestling",
          `Snowboarding` = "(27) Snowboarding",
          `Weightlifting` = "(28) Weightlifting",
          `Handball` = "(29) Handball",
          `Rowing` = "(30) Rowing / Crew",
          `Cricket` = "(31) Cricket",
          `Ping Pong` = "(32) Ping pong",
          `Colorguard` = "(33) Color / Winterguard",
          `Other` = "(66) Other sport"
      )))
  }
  
  else{
    data <- data
  }
  
  return(data)
}
```


```{r}
vars_by_sport <- function(data_frame, sport, var1, var2) {
  
  indicators <- get_indicators(sport)
  
  q1_df <- data_frame %>%
    filter(if_any(indicators, is_marked)) %>%
    dplyr::select("CASEID", all_of(var1), all_of(var2)) %>%
    filter(complete.cases(.))
  
  q1_df <- df_recoded(q1_df, var1)
  q1_df <- df_recoded(q1_df, var2)
  
  return(q1_df)
  
}
```


```{r}
# obtain different "scores" to measure different areas of health and wellness

# modify data frame
df_sports <- mutate(df, sport = "")
df_sports <- df_recoded(df_sports, "PSPORT")

# sports <- as.character(df_sports$PSPORT)
sports <- c("Boxing", "Baseball", "Basketball", "Bowling", "Cheerleading", "Cross Country", "Dance", "Field Hockey", "Football", "Golf", "Gymnastics", "Ice Hockey", "Lacrosse", "Rugby", "Skiing", "Soccer", "Swimming", "Tennis", "Track", "Volleyball", "Wrestling")

# for(s in sports){
#   df_sports <- df_sports %>%
#     rowwise() %>%
#     mutate(sport = case_when(
#         (if_any(get_indicators(s), is_marked) || as.character(PSPORT) == s) && sport == "" ~ s,
#         (if_any(get_indicators(s), is_marked) || as.character(PSPORT) == s) && !(sport == "") ~ paste(sport, s, sep=", "),
#         !if_any(get_indicators(s), is_marked) && !(as.character(PSPORT) == s) ~ sport
#       ))
# }

```


```{r}
# scoring:
  # Extreme positive response: +2
  # Moderate positive response: +1
  # Neutral/No response: +0
  # Moderate negative response: -1
  # Extreme negative response: -2

for(v in names(df_sports)){
  if(!(startsWith(v, "PSPORT"))){
      df_sports <- df_recoded(df_sports, v)
  }
}

for(v in names(df_sports)){
  if(startsWith(v, "CESD") || startsWith(v, "MPSQ") || startsWith(v, "TEOSQ") || startsWith(v, "GENRI")){
    df_sports[,v] <- as.numeric(as.character(df_sports[,v]))
  }
}

# compute mental health "score" for each student
df_sports <- df_sports %>%
  mutate(`Mental Health Score` = rowSums(dplyr::select(., starts_with("CESD")), na.rm = TRUE)) %>%
  mutate(`Motivation Score` = rowSums(dplyr::select(., starts_with("MPSQ")), na.rm = TRUE)) %>%
  mutate(`Success Score` = rowSums(dplyr::select(., starts_with("TEOSQ")), na.rm = TRUE)) %>%
  mutate(`Risk Behavior Score` = rowSums(dplyr::select(., starts_with("GENRI")), na.rm = TRUE))

#add sport_type to df_sports
individual_sport <- c('Boxing', 'Bowling','Cross Country', 'Dance', 'Golf', 'Gymnastics', 'Skiing', 'Swimming', 'Tennis', 'Track', 'Wrestling', 'Equestrian', 'Figure Skating', 'Snowboarding', 'Weightlifting', 'Ping Pong')

df_sports <- df_sports %>% 
  mutate(sport_group = ifelse(df_sports$PSPORT %in% individual_sport, 'Individual', 'Team'))


```


## Who took this survey?

```{r}
##Demographics breakdown
library(ggthemes)

df$RACE <- recode_factor(df$RACE, 
                         `White` = "(4) White or Caucasian",
                         `Asian American` = "(2) Asian American or Pacific Islander",
                         `Black/ African American` = "(3) Black or African American",
                         `American Indian / Other` = "(6) American Indian / Native American / Other",
                         `Mixed` = "(5) Mixed Race")

s1<- ggplot(df, aes(AGE)) +
  geom_bar(fill = "#6BAED6") +
  xlab("Age") +
  ylab("") +
  theme_classic() +
  scale_x_continuous(breaks=seq(17,25,1)) 

s2<- ggplot(df, aes(fct_recode(SEX, 
                                  `Male` = "(0) Male" , 
                                  `Female` = "(1) Female"))) +
  geom_bar(fill = "#6BAED6") +
  xlab("Gender") +
  ylab("") +
  theme_classic()

s3<- ggplot(df, aes(fct_recode(RACE, 
                              White = "(4) White or Caucasian",
                              `Asian American` = "(2) Asian American or Pacific Islander",
                              `Black or African American` = "(3) Black or African American",
                              `American Indian / Other` = "(6) American Indian / Native American / Other",
                              `Mixed Race` = "(5) Mixed race" ))) +
  geom_bar(fill = "#6BAED6") +
  xlab("Race") +
  ylab("") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20))
  

s4<- ggplot(df, aes(fct_recode(COLYEAR,
                               `Freshman` = "(1) Freshman",
                               `Sophomore` = "(2) Sophomore", 
                               `Junior` = "(3) Junior", 
                               `Senior` = "(4) Senior",
                               `Other` = "(5) Other"))) + 
  geom_bar(fill = "#6BAED6") +
  xlab("Year in College") +
  ylab("") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


grid.arrange(s1, s2, s3, s4, ncol=2, top = textGrob("Respondents Demographic Information"))


```

Students who took part in this survey are within the age range of College Students as is expected. Some older students who participated in the study may include graduate students and some students who started college later than their peers or are taking extra time to finish. The breakdown between men and women is fairly evenly split, which is nice to see. The majority of respondents were white, which may lead to some biases in responses, particularly because mental health is known to have strong correlations with economic status and race. However, when you consider this is a survey given to students at Northeastern University, a private university in Boston, in 2006 it could be feasible that this breakdown represented the student population at that time, especially for athletes and those interested in sports. Lastly, we see from the demographics that we have a majority of underclassmen who took the survey (Freshman, Sophomore) which may also lead to biased results as the stresses of college, adult life, and a persons relationship to sport likely change between Freshman and Senior years of college. 

Now that we know a little bit about the demographics of respondents, lets take a look at what sports they participated in:

```{r}
#Athlete Breakdown Introduction
#primary sports of all respondents

df_sports %>% 
  drop_na(PSPORT) %>% 
  ggplot(aes(x=fct_rev(fct_infreq(PSPORT)))) +
  geom_bar(fill = "#6BAED6") + # color = "#2171b5"
  coord_flip() +
  ggtitle("Primary Sport Indicated by Students") +
  ylab("Count") +
  xlab("Sport") +
  theme_classic(10) +
  theme(plot.title = element_text(hjust = 0.5))

s5<- ggplot(df_sports, aes(x=fct_infreq(PSPORT))) +
  geom_bar(fill = "cadetblue4") +
  coord_flip() +
  ggtitle("Primary Sport Indicated by Students") +
  ylab("Count") +
  xlab("Sport")
  #theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


#college sport played in the past year
df_recentcolsport <- df %>%
  dplyr::select("CASEID", starts_with("TP")) %>% 
  pivot_longer(!c("CASEID"), names_to = "Sport", values_to = "Participated" ) %>%
  filter(Participated == '(1) Marked') %>%
  separate(Sport, into = c('Level', 'sport'), sep = 4) %>%
  mutate(Level = 
           ifelse(Level == 'TPCL', 'College', 'Community')) %>%
  mutate(sport = 
           case_when(
    sport == 'BX' ~ 'Boxing',
    sport == 'BB' ~ 'Baseball', 
    sport == 'BK' ~ 'Basketball',
    sport == 'BL' ~ 'Bowling',
    sport == 'CH' ~ 'Cheerleading',
    sport == 'CC' ~ 'Cross Country',
    sport == 'DN' ~ 'Dance', 
    sport == 'FH' ~ 'Field Hockey',
    sport == 'FB' ~ 'Football',
    sport == 'GF' ~ 'Golf', 
    sport == 'GM' ~ 'Gymnastics', 
    sport == 'IH' ~ 'Ice Hockey',
    sport == 'LC' ~ 'Lacrosse', 
    sport == 'RG' ~ 'Rugby', 
    sport == 'SK' ~ 'Skiing',
    sport == 'SC' ~ 'Soccer',
    sport == 'SB' ~ 'Softball', 
    sport == 'SW' ~ 'Swimming', #swimming and diving
    sport == 'TN' ~ 'Tennis',
    sport == 'TF' ~ 'Track', #track and field
    sport == 'VB' ~ 'Volleyball',
    sport == 'WR' ~ 'Wrestling', 
    sport == 'O1' ~ 'Other', 
    sport == 'O2' ~ 'Other', 
    sport == 'NO' ~ 'No_Teams'
  )) %>%
  filter(sport != 'No_Teams')

s6<- ggplot(df_recentcolsport) +
  geom_bar(mapping = aes(x=fct_infreq(sport), fill = Level)) +
  coord_flip() +
  scale_fill_manual(values = c("cadetblue3", "cadetblue4")) + 
  ggtitle("Types of sports students participated in within the past year \n at the college or community level") +
  xlab("Sport") +
  ylab("Count") +
  theme_classic()

#s5
#s6

```

Students selected a wide variety of sports as their Primary Sport. Each student was only able to elect one sport, however we are not displaying those who did not select any sport as we will only be looking at students with a primary sport. In addition, we will exclude "Other" sports in the following analyses as we try to investigate how sport types correlate with mental health and other outlook indicators. 

We see that the most popular sports are Basketball, Soccer, Football and Baseball. This makes sense for an American University! 


## Investigating Mental Health Responses 

Our primary questions of interest surround how aspects of sport, performance, and team correlate with Mental Health Indicators. As part of the survey given to students, there were 10 questions that were meant to assess each students mental health. Students were asked to respond to the following prompt:

`"Below is a list of some of the ways you may have felt or behaved recently. Please indicate how often you have felt this way during the past week."`

Let's take a look at how students responded to these questions: 

```{r}
#subset to MH response data
library(HH)

MH_responses <- as.data.frame(df) %>%
  dplyr::select("CASEID", starts_with("CESD"), "PSPORT") %>%
  mutate(PSPORT = fct_recode(PSPORT,
          `Badminton` = "(01) Badminton",                          
          `Baseball` = "(02) Baseball",
          `Basketball` = "(03) Basketball",
          `Bowling` = "(04) Bowling",
          `Boxing` = "(05) Boxing / Martial arts",
          `Cheerleading` = "(06) Cheer / Spirit",
          `Cross Country` = "(07) Cross country",
          `Dance` = "(08) Dance team",
          `Equestrian` = "(09) Equestrian",
          `Field Hockey` = "(11) Field hockey",
          `Figure Skating` = "(12) Figure skating",
          `Football` = "(13) Football",
          `Golf` = "(14) Golf",
          `Gymnastics` = "(15) Gymnastics",
          `Ice Hockey` = "(16) Ice hockey / Roller hockey",
          `Lacrosse` = "(17) Lacrosse",
          `Rugby` = "(18) Rugby",
          `Skiing` = "(19) Skiing",
          `Soccer` = "(20) Soccer",
          `Softball` = "(21) Softball",
          `Swimming` = "(22) Swimming / Diving",
          `Tennis` = "(23) Tennis / Racquetball",
          `Track` = "(24) Track and field",
          `Volleyball` = "(25) Volleyball",
          `Wrestling` = "(26) Wrestling",
          `Snowboarding` = "(27) Snowboarding",
          `Weightlifting` = "(28) Weightlifting",
          `Handball` = "(29) Handball",
          `Rowing` = "(30) Rowing / Crew",
          `Cricket` = "(31) Cricket",
          `Ping Pong` = "(32) Ping pong",
          `Colorguard` = "(33) Color / Winterguard",
          `Other` = "(66) Other sport")) %>%
  mutate(sport_group = 
           ifelse(PSPORT %in% individual_sport, 'Individual', 'Team')) %>%
  rename("Bothered by things that \n usually don't bother me" = CESD01,
        "Trouble keeping mind on \n what I was doing" = CESD02,
        "Depressed" = CESD03,
        "Everything was an effort" = CESD04,
        "Hopeful about future" = CESD05,
        "Fearful" = CESD06,
        "Sleep was restless" = CESD07,
        "Happy" = CESD08,
        "Lonely" = CESD09,
        "Could not get going" = CESD10) %>%
  drop_na() 

MH_pivot <- MH_responses[,c(1:11)] %>% 
  pivot_longer(!CASEID, names_to="Questions", values_to="Answer") %>%
  group_by(Questions, Answer) %>%
  summarize(Count=n()) %>%
  mutate(Answer = fct_recode(Answer, 
              `1-Rarely or none \n of the time` = "(1) Rarely or none of the time (less than 1 day)",
              `2-Some or a little \n of the time` = "(2) Some or a little of the time (1-2 days)",
              `3-Occasionally or \n moderate amount \n of time` = "(3) Occasionally or a moderate amount of time (3-4 days)", 
              `4 All of \n the time` = "(4) All of the time (5-7 days)"))

ggplot(MH_pivot) +
  geom_bar(aes(x = reorder(Questions, Count), y=-Count, fill=Answer), color="black", position="stack", stat="identity") +
  coord_flip() + 
  ggtitle("Survey Responses to MH Questions") +
  ylab("") +
  xlab("Questions") +
  scale_fill_brewer(palette="Blues") +
  theme_classic() +
  theme(legend.position= "bottom", legend.justification = "left", axis.text.x=element_blank(), axis.ticks.x=element_blank(), 
        plot.title = element_text(hjust = 0.5))

```



```{r}
#view MH responses for team vs. individual sports 

MH_pivot_team <- MH_responses[] %>% 
  pivot_longer(!c(CASEID, sport_group, PSPORT), names_to="Questions", values_to="Answer") %>%
  group_by(Questions, Answer, sport_group) %>%
  summarize(Count=n()) %>%
  ungroup() %>%
  mutate(Answer = fct_recode(Answer, 
              `1-Rarely or none \n of the time` = "(1) Rarely or none of the time (less than 1 day)",
              `2-Some or a little \n of the time` = "(2) Some or a little of the time (1-2 days)",
              `3-Occasionally or \n moderate amount \n of time` = "(3) Occasionally or a moderate amount of time (3-4 days)", 
              `4 All of \n the time` = "(4) All of the time (5-7 days)")) 

# #ggplot(MH_pivot_team) +
#   geom_bar(aes(x = reorder(Questions, Count), y=-Count, fill=Answer), color="black", position="stack", stat="identity") +
#   facet_grid(~sport_group, scales = "free_x") +
#   coord_flip() + 
#   ggtitle("Survey Responses to MH Questions") +
#   ylab("") +
#   xlab("Questions") +
#   scale_fill_brewer(palette="Blues") +
#   theme_classic() +
#   theme(legend.position= "bottom", legend.justification = "left", axis.text.x=element_blank(), axis.ticks.x=element_blank(),
#         plot.title = element_text(hjust = 0.5))


```

```{r}
MH_pivot_dt <- MH_responses[] %>% 
  pivot_longer(!c(CASEID, sport_group, PSPORT), names_to="Questions", values_to="Answer") %>%
  group_by(Questions, Answer, PSPORT) %>%
  summarize(Count=n()) %>%
  ungroup() %>%
  mutate(Answer = fct_recode(Answer, 
              `1-Rarely or none \n of the time` = "(1) Rarely or none of the time (less than 1 day)",
              `2-Some or a little \n of the time` = "(2) Some or a little of the time (1-2 days)",
              `3-Occasionally or \n moderate amount \n of time` = "(3) Occasionally or a moderate amount of time (3-4 days)", 
              `4 All of \n the time` = "(4) All of the time (5-7 days)")) %>%
  filter(PSPORT == "Dance" | PSPORT == "Track")

# #ggplot(MH_pivot_dt) +
#   geom_bar(aes(x = reorder(Questions, Count), y=-Count, fill=Answer), color="black", position="stack", stat="identity") +
#   facet_grid(~PSPORT, scales = "free_x") +
#   coord_flip() + 
#   ggtitle("Survey Responses to MH Questions") +
#   ylab("") +
#   xlab("Questions") +
#   scale_fill_brewer(palette="Blues") +
#   theme_classic() +
#   theme(legend.position= "bottom", legend.justification = "left", axis.text.x=element_blank(), axis.ticks.x=element_blank())

```


Add discussion of graph or graphs here. Transition to self made scores to see if MH correlates with any other behaviors


## Investigating Sport Motivation, Perspectives on Success, Behavior Patterns, and Mental Health for Athletes 

In effort to assess how factors related to sports and sport performance are related to an athletes mental health, we created a scoring formula for all students based on their responses to the survey questions:

* Mental Health Score -- Mental Health questions were posed in the following manner: 
`"Below is a list of some of the ways you may have felt or behaved recently. Please indicate how often you have felt this way during the past week."`
Based on the feeling, we assigned scores that were positive to indicate positive mental health outlook versus negative scores to indicate a negative outlook on mental health. For example, if a respondent answered "I was happy" with "All of the time" they would get +2 points, versus a response of "Rarely or None of the Time" would get -2 points. In summary, a high mental health score denotes a positive mental health outlook.

* Internal Motivation Score -- 

* Risk Averse Score -- 

* Success through Hardwork Score -- 

```{r, fig.width = 5, fig.asp = .62}
#Primary Sport Analysis

df_scores <- df_sports %>%
  dplyr::select("CASEID", "PSPORT", "Mental Health Score", "Motivation Score", "Success Score", "Risk Behavior Score", "sport_group") %>%
  group_by(PSPORT) %>%
  mutate(avg_mh = mean(`Mental Health Score`)) %>%
  group_by(PSPORT) %>%
  mutate(avg_motiv = mean(`Motivation Score`)) %>%
  group_by(PSPORT) %>%
  mutate(avg_success = mean(`Success Score`)) %>%
  group_by(PSPORT) %>%
  mutate(avg_risk = mean(`Risk Behavior Score`)) %>%
  distinct(CASEID, PSPORT, .keep_all = TRUE)

df_mh_scores <- df_scores %>%
  dplyr::select("PSPORT", avg_mh, sport_group) %>%
  unique() %>%
  filter(!is.na(PSPORT))

g1 <- ggplot(df_mh_scores, aes(x = reorder(PSPORT, -avg_mh), y = avg_mh, fill = sport_group)) +
  geom_col() +
  geom_hline(yintercept = mean(df_mh_scores$avg_mh), col="tomato1") +
  scale_fill_manual(values = c("royalblue4", "lightskyblue")) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")

df_motiv_scores <- df_scores %>%
  dplyr::select("PSPORT", avg_motiv, sport_group, avg_mh) %>%
  unique() %>%
  filter(!is.na(PSPORT))

g2 <- ggplot(df_motiv_scores, aes(x = reorder(PSPORT, -avg_mh), y = avg_motiv, fill = sport_group)) +
  geom_col() +
  geom_hline(yintercept = mean(df_motiv_scores$avg_motiv), col="tomato1") +
  scale_fill_manual(values = c("royalblue4", "lightskyblue")) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")

df_success_scores <- df_scores %>%
  dplyr::select("PSPORT", avg_success, sport_group, avg_mh) %>%
  unique() %>%
  filter(!is.na(PSPORT))

g3<- ggplot(df_success_scores, aes(x = reorder(PSPORT, -avg_mh), y = avg_success, fill = sport_group)) +
  geom_col() +
  geom_hline(yintercept = mean(df_success_scores$avg_success), col="tomato1") +
  scale_fill_manual(values = c("royalblue4", "lightskyblue")) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")

df_risk_scores <- df_scores %>%
  dplyr::select("PSPORT", avg_risk, sport_group, avg_mh) %>%
  unique() %>%
  filter(!is.na(PSPORT))

g4 <- ggplot(df_risk_scores, aes(x = reorder(PSPORT, -avg_mh), y = avg_risk, fill = sport_group)) +
  geom_col() +
  geom_hline(yintercept = mean(df_risk_scores$avg_risk), col="tomato1") +
  scale_fill_manual(values = c("royalblue4", "lightskyblue")) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "bottom")


#plot_grid(g1, g2, g3, g4, labels=c(1, 2, 3, 4), ncol = 2, nrow= 2)

```

```{r}
#try correlation plots for MH scores 

#library(corrplot)

#calculate pairwaise correlation values for mh score columns and store as matrix 
MH_corr <- df_scores[,c(8:11)] %>%
  rename(`Mental Health Score` = "avg_mh", 
         `Motivation Score` = "avg_motiv", 
         `Outlook on Success Score` = "avg_success",
         `Risk Avoidance Score` = "avg_risk") %>%
  cor(., use = "pairwise.complete.obs")

#option 1
# M = cor(MH_corr)
# corrplot(M, order = 'hclust', addrect = 2)

# #option 2
# c1 <- ggcorrplot(MH_corr,
#            hc.order = TRUE,
#            lab = TRUE) +
#   scale_color_brewer(palette= "Blues")
# 
# #check per sport type for differences? 
# MH_team_corr <- df_scores %>%
#   filter(sport_group == 'Team') 
# 
# MH_team_corr <- MH_team_corr[,c(8:11)] %>%
#   cor(., use = "pairwise.complete.obs")
# 
# c2<- ggcorrplot(MH_team_corr,
#            hc.order = TRUE,
#            lab = TRUE)
# 
# MH_ind_corr <- df_scores %>%
#   filter(sport_group == 'Individual')
# 
# MH_ind_corr <- MH_ind_corr[,c(8:11)] %>%
#   cor(., use = "pairwise.complete.obs")
# 
# c3 <- ggcorrplot(MH_ind_corr,
#                  hc.order = TRUE,
#                  lab = TRUE)

#c1 + ggtitle('Correlation for All Athletes')
 # c2 + ggtitle('Correlation for Team Athletes')
# c3 + ggtitle('Correlation for Individual Athletes')


ggcorrplot(MH_corr, hc.order = TRUE, type = "lower", colors = c("coral3", "grey99", "royalblue1"), lab = TRUE, insig = "blank") + 
  ggtitle("Correlation Between Assessment Types Across Team Averages") +
  theme(plot.title = element_text(hjust = 0.5))

```

We were interested in understanding how these indicators correlated with eachother and most importantly with mental health scores. Unfortunately, there seems to be only a loose correlation between Mental Health Scores and the various indicators. The strongest being a positive correlation (0.62) between mental health and motivation. 

The strongest correlation observed overall is between Motivation and Outlook on Success. Higher scores in these two categories mean motivation is mostly coming from within (versus external motivation) and that success comes from hardwork and training (versus pure skill or talent), respectively. This makes sense intuitively because if someone has internal motivation to do something, they likely use that motivation to work at whatever the skill or task is. 

Now looking deeper at these scores across sports and sport type we can draw a few conclusions. 


```{r}
#try side by side bar chart for scores 
df_score_pivot <- df_scores[,c(1:2, 7:11)] %>%
  pivot_longer(!c(PSPORT,sport_group, CASEID), names_to="Assessment", values_to="Score") %>%
  group_by(PSPORT) %>%
  mutate(Assessment = as.factor(Assessment)) %>%
  mutate(Assessment = fct_recode(Assessment, 
                                `Mental Health \n Score` = "avg_mh",
                                `Motivated Internally` = "avg_motiv",
                                `Risk Averse` = "avg_risk",
                                `Success \n Through Hardwork` = "avg_success")) %>%
  filter(PSPORT!="NA", PSPORT !="Other")


# #single plot
# ggplot(data = df_score_pivot) +
#   geom_col(aes(x = PSPORT, y = Score, fill = Assessment), color = "black", position="dodge", size = .25) +
#   facet_grid(~sport_group, scales="free_x", space = "free_x") +
#   geom_hline(yintercept = mean(df_scores$avg_mh), col="grey", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_motiv), col="#bdd7e7", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_risk), col="#6baed6", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_success), col="#2171b5", size =.25, alpha = 1) +
#   theme_classic(9) +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
#   ggtitle("Health & Life Outlook Scores Across Sports") +
#   ylab("Average Score") +
#   xlab("Sport") +
#   scale_fill_brewer(palette="Blues") 
# 
# #two plots
# ggplot(data = df_score_pivot %>% filter(sport_group == "Team")) +
#   geom_col(aes(x = PSPORT, y = Score, fill = Assessment), color = "black", position="dodge", size = .25) +
#   geom_hline(yintercept = mean(df_scores$avg_mh), col="grey", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_motiv), col="#bdd7e7", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_risk), col="#6baed6", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_success), col="#2171b5", size =.25, alpha = 1) +
#   theme_classic(9) +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
#   ggtitle("Health & Life Outlook Scores Across Team Type Sports") +
#   ylab("Average Score") +
#   xlab("Sport") +
#   scale_fill_brewer(palette="Blues") 
# 
# ggplot(data = df_score_pivot %>% filter(sport_group == "Individual")) +
#   geom_col(aes(x = PSPORT, y = Score, fill = Assessment), color = "black", position="dodge", size = .25) +
#   geom_hline(yintercept = mean(df_scores$avg_mh), col="grey", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_motiv), col="#bdd7e7", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_risk), col="#6baed6", size =.25, alpha = 1) +
#   geom_hline(yintercept = mean(df_scores$avg_success), col="#2171b5", size =.25, alpha = 1) +
#   theme_classic(9) +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
#   ggtitle("Health & Life Outlook Scores Across Individual Type Sports") +
#   ylab("Average Score") +
#   xlab("Sport") +
#   scale_fill_brewer(palette="Blues") 
  
#dotplot view & separate into two plots for easier reading
ggplot(data = df_score_pivot %>% filter(sport_group == "Team")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment), size = 3) +
  geom_hline(yintercept = mean(df_scores$avg_mh), col="grey", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_motiv), col="#bdd7e7", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_risk), col="#6baed6", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_success), col="#2171b5", size =.25, alpha = 1) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores Across Team Sports") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2") 

#fix axis and sort more thoughfully

ggplot(data = df_score_pivot %>% filter(sport_group == "Individual")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment), size = 3) +
  geom_hline(yintercept = mean(df_scores$avg_mh), col="grey", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_motiv), col="#bdd7e7", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_risk), col="#6baed6", size =.25, alpha = 1) +
  geom_hline(yintercept = mean(df_scores$avg_success), col="#2171b5", size =.25, alpha = 1) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores Across Individual Sports") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2") 


```

In looking at this plot, there are many interesting things to note.

We'll talk about maximum values per Assessment first:

* Rugby has the highest average mental health score amongst all athletes and sports polled! After Rugby, Figure Skating, Equestrian, and Skiing are the next highest scorers respectively. 

* Figure Skating has the highest score for internal motivation. However it is important to remember that Figure Skating had only one response, which is not a compelling amount of data for which we can say anything conclusive about the sport or the athletes within it. The second highest score for internal motivation is Gymnastics, closely followed by Skiing. Interestingly, these are all individual sports. Intuitively, this makes sense as people doing individual sports need to be heavily motivated in order to perform well in their respective sport. This is not to say team sport athletes are not motivated, however they could rely more on their teammates and thereby have more external motivation from the team, versus someone who is competing alone. 

* Ping-Pong ranks as the most risk averse sport amongst athletes polled in this survey! The runners up were Rowing and Colorguard. 

* Rowing has the highest success through hardwork score. In fact, all four of the categories are above average for Rowing. Gymnastics was second for success through hardwork, followed by Rugby. Based on the definition of the score, this would mean these three sports responded in the least ego-centric manner and attribute their success more to hardwork than pure talent and being "better" than their competitors. 

Some indicators that deserve deeper conversation: 

* Colorguard is the only sport that has a negative mental health score. Colorguard is a team of performers who perform choreographed dances and routines with various equipment to the music of the marching band show. Although the sports are quite different, there are some parallels to be made between Colorguard and Dance, however their scores are quite different upon comparison! Dance has a below average success through hardwork score, but above average on all other assessments, while colorguard is well below average on mental health and above average on others. One thing that makes colorguard different than all other sports on this list is the fact that the colorguard is performing alongside another performance, that being the marching band, perhaps that has some effect on participants that is not exhibited in other sports. 

* Badminton and Weightlifting are the only two sports that skewed more towards the ego side of outlook on their success than on hardwork. This is surprising for weightlifting because weightlifting is almost not at all related to athletic ability or "being good" at it, since you need to build muscle overtime in order to become proficient, however perhaps something about the culture of weightlifting propegates this mentality. 

* The amount of pro-risky behavior sports was surprising to us as well. Based on previous knowledge and research, we anticipated that football, rugby, boxing, wrestling, and ice hockey would be on the riskier side due to the violent aspects of their sport and sport cultures however cross country, golf, and badminton were very unexpected additions to this list. 

Individual sports and Team sports don't show trends between groups indicating there may be no correlation between these factors and the type of sport, team or individual, you are part of. So we wondered if perhaps grouping by gender would be a better indicator for any of these assessments. We hand selected sports that had representation across both genders (in addition we also added Baseball and Softball as comparable sports for male and female respectively). 

```{r}
#look into male vs female breaks... 
df_score_gender<- df_sports %>%
  dplyr::select("CASEID", "PSPORT", "Mental Health Score", "Motivation Score", "Success Score", "Risk Behavior Score", "sport_group", "SEX") %>%
  group_by(PSPORT, SEX) %>%
  mutate(avg_mh = mean(`Mental Health Score`)) %>%
  group_by(PSPORT, SEX) %>%
  mutate(avg_motiv = mean(`Motivation Score`)) %>%
  group_by(PSPORT, SEX) %>%
  mutate(avg_success = mean(`Success Score`)) %>%
  group_by(PSPORT, SEX) %>%
  mutate(avg_risk = mean(`Risk Behavior Score`)) %>%
  distinct(CASEID, PSPORT, SEX, .keep_all = TRUE) %>%
  drop_na()

df_score_pivot2 <- df_score_gender[,c(1:2, 8:12)] %>%
  pivot_longer(!c(PSPORT, CASEID, SEX), names_to="Assessment", values_to="Score") %>%
  group_by(PSPORT) %>%
  mutate(Assessment = as.factor(Assessment)) %>%
  mutate(Assessment = fct_recode(Assessment, 
                                `Mental Health \n Score` = "avg_mh",
                                `Motivated Internally` = "avg_motiv",
                                `Risk Averse` = "avg_risk",
                                `Success \n Through Hardwork` = "avg_success")) %>%
  mutate(SEX = fct_recode(SEX, 
                          Male = "(0) Male",
                          Female = "(1) Female")) %>%
  #filter(PSPORT!="NA", PSPORT !="Other") %>%
  filter(PSPORT %in% c("Basketball", "Golf", "Boxing", "Rugby", "Soccer", "Swimming", "Track", "Lacrosse", "Volleyball", "Baseball", "Softball"))

# ggplot(data = df_score_pivot2) +
#   geom_col(aes(x = PSPORT, y = Score, fill = Assessment), color = "black", position="dodge", size = .25) +
#   facet_wrap(~SEX, scales="free_x") +
#   theme_classic(9) +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
#   ggtitle("Health & Life Outlook Scores for Select Sports by Gender") +
#   ylab("Average Score") +
#   xlab("Sport") +
#   scale_fill_brewer(palette="Blues") 

#try dotplot to see what it looks like
ggplot(data = df_score_pivot2) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment), size = 3, alpha =.5) +
  facet_wrap(~SEX, nrow = 2) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Select Sports by Gender") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2")
```

There is one assessment that clearly differs between men and women: risk tolerance! For all sports that have male and female participants, the males are more risk tolerant than the females are. This outcome is not incredibly surprising, however it is interesting to see that no female sport averages fell into the negative area. The closest were female rugby players. Based on the nature of rugby, this seems reasonable. 

For some sports like soccer, females have a lower mental health score than males in their sport, however this is not consistent across all sports. When we compare baseketball we see that female baseketball players have a higher mental health score. So we cannot say that that one or the other gender has better or worse mental health outlooks. 

We also see that male swimmers skew towards an ego-centered view on success. The next closest are female and male golfers. 

we wondered whether there were any insights to be gained from checking whether year in college was correlated with these indicators.

```{r}
df_score_year<- df_sports %>%
  dplyr::select("CASEID", "PSPORT", "Mental Health Score", "Motivation Score", "Success Score", "Risk Behavior Score", "sport_group", "COLYEAR") %>%
  group_by(PSPORT, COLYEAR) %>%
  mutate(avg_mh = mean(`Mental Health Score`)) %>%
  group_by(PSPORT, COLYEAR) %>%
  mutate(avg_motiv = mean(`Motivation Score`)) %>%
  group_by(PSPORT, COLYEAR) %>%
  mutate(avg_success = mean(`Success Score`)) %>%
  group_by(PSPORT, COLYEAR) %>%
  mutate(avg_risk = mean(`Risk Behavior Score`)) %>%
  distinct(CASEID, PSPORT, COLYEAR, .keep_all = TRUE) %>%
  drop_na()

df_year_pivot <- df_score_year[,c(1:2, 8:12)] %>%
  pivot_longer(!c(PSPORT, CASEID, COLYEAR), names_to="Assessment", values_to="Score") %>%
  group_by(PSPORT) %>%
  mutate(Assessment = as.factor(Assessment)) %>%
  mutate(Assessment = fct_recode(Assessment, 
                                `Mental Health \n Score` = "avg_mh",
                                `Motivated Internally` = "avg_motiv",
                                `Risk Averse` = "avg_risk",
                                `Success \n Through Hardwork` = "avg_success")) %>%
  mutate(COLYEAR = fct_recode(COLYEAR,
                               `Freshman` = "(1) Freshman",
                               `Sophomore` = "(2) Sophomore", 
                               `Junior` = "(3) Junior", 
                               `Senior` = "(4) Senior",
                               `Other` = "(5) Other")) %>%
  filter(PSPORT != "Other")

ggplot(data = df_year_pivot %>%
         filter(COLYEAR == "Freshman")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment)) +
 # facet_wrap(~COLYEAR, scales="free_x", nrow = 2) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Select Sports - Freshman") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2") 

ggplot(data = df_year_pivot %>%
         filter(COLYEAR == "Sophomore")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment)) +
 # facet_wrap(~COLYEAR, scales="free_x", nrow = 2) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Sports - Sophomore") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2") 

ggplot(data = df_year_pivot %>%
         filter(COLYEAR == "Junior")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment)) +
  #facet_wrap(~COLYEAR, scales="free_x", nrow = 2) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Sports - Junior") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2")

ggplot(data = df_year_pivot %>%
         filter(COLYEAR == "Senior")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment)) +
  #facet_wrap(~COLYEAR, scales="free_x", nrow = 2) +
  coord_flip() +
  theme_bw(9) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Sports - Junior") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2")

ggplot(data = df_year_pivot %>%
         filter(COLYEAR == "Other")) +
  geom_point(aes(x = PSPORT, y = Score, color = Assessment), size = 3) +
  theme_bw(9) +
  coord_flip() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom", plot.title = element_text(hjust = 0.5)) +
  ggtitle("Health & Life Outlook Scores for Sports - Other") +
  ylab("Average Score") +
  xlab("Sport") +
  scale_color_brewer(palette="Set2") 



```



```{r}
library(ggalluvial)

MH_responses2 <- as.data.frame(df) %>%
  dplyr::select("CASEID", starts_with("CESD"), "PSPORT", "SEX") %>%
  mutate(PSPORT = fct_recode(PSPORT,
          `Badminton` = "(01) Badminton",                          
          `Baseball` = "(02) Baseball",
          `Basketball` = "(03) Basketball",
          `Bowling` = "(04) Bowling",
          `Boxing` = "(05) Boxing / Martial arts",
          `Cheerleading` = "(06) Cheer / Spirit",
          `Cross Country` = "(07) Cross country",
          `Dance` = "(08) Dance team",
          `Equestrian` = "(09) Equestrian",
          `Field Hockey` = "(11) Field hockey",
          `Figure Skating` = "(12) Figure skating",
          `Football` = "(13) Football",
          `Golf` = "(14) Golf",
          `Gymnastics` = "(15) Gymnastics",
          `Ice Hockey` = "(16) Ice hockey / Roller hockey",
          `Lacrosse` = "(17) Lacrosse",
          `Rugby` = "(18) Rugby",
          `Skiing` = "(19) Skiing",
          `Soccer` = "(20) Soccer",
          `Softball` = "(21) Softball",
          `Swimming` = "(22) Swimming / Diving",
          `Tennis` = "(23) Tennis / Racquetball",
          `Track` = "(24) Track and field",
          `Volleyball` = "(25) Volleyball",
          `Wrestling` = "(26) Wrestling",
          `Snowboarding` = "(27) Snowboarding",
          `Weightlifting` = "(28) Weightlifting",
          `Handball` = "(29) Handball",
          `Rowing` = "(30) Rowing / Crew",
          `Cricket` = "(31) Cricket",
          `Ping Pong` = "(32) Ping pong",
          `Colorguard` = "(33) Color / Winterguard",
          `Other` = "(66) Other sport")) %>%
  mutate(sport_group = 
           ifelse(PSPORT %in% individual_sport, 'Individual', 'Team')) %>%
  rename("Bothered by \n things that usually \n don't bother me" = CESD01,
        "Trouble keeping \n mind on what \n I was doing" = CESD02,
        "Depressed" = CESD03,
        "Everything was \n an effort" = CESD04,
        "Hopeful about future" = CESD05,
        "Fearful" = CESD06,
        "Sleep was restless" = CESD07,
        "Happy" = CESD08,
        "Lonely" = CESD09,
        "Could not get going" = CESD10) %>%
  mutate(SEX = fct_recode(SEX, 
                          Male = "(0) Male",
                          Female = "(1) Female")) %>%
  drop_na() 

MH_pivot2 <- MH_responses2[,c(1:13)] %>%
  pivot_longer(!c(CASEID, SEX, PSPORT), names_to="Assessment", values_to="Score") %>%
  group_by(CASEID, SEX, PSPORT, Assessment, Score ) %>%
  summarize(Freq = n()) %>%
  ungroup() %>%
  mutate(Score = fct_recode(Score, 
                            Rarely = "(1) Rarely or none of the time (less than 1 day)", 
                            Sometimes = "(2) Some or a little of the time (1-2 days)",
                            Occasionally = "(3) Occasionally or a moderate amount of time (3-4 days)", 
                            Always = "(4) All of the time (5-7 days)")) %>%
  filter(Assessment %in% c("Happy", "Fearful", "Hopeful about future", "Depressed", "Lonely"))


ggplot(data = (MH_pivot2 %>% filter(PSPORT == "Dance")), aes(x = Assessment, stratum = fct_rev(Score), alluvium = CASEID,
                          y = Freq, 
                      fill = Score, label = Score)) +
  geom_flow() +
  #coord_flip() +
  geom_stratum(alpha = 0.5) +
  geom_text(stat = "stratum", size = 2) +
  scale_fill_brewer(palette = "Set2") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Survey Response Path for Mental Health Questions - Dance")

ggplot(data = (MH_pivot2 %>% filter(PSPORT == "Baseball")), aes(x = Assessment, stratum = fct_rev(Score), alluvium = CASEID,
                          y = Freq, 
                      fill = Score, label = Score)) +
  geom_flow() +
  #coord_flip() +
  geom_stratum(alpha = 0.5) +
  geom_text(stat = "stratum", size = 2) +
  scale_fill_brewer(palette = "Set2") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Survey Response Path for Mental Health Questions - Baseball")

```





```{r}
# # data frames by sport for q1: mental health vs. thoughts on sports
# 
# # depression frequency vs. importance of fun
# track <- vars_by_sport(df, "Track", "CESD03", "MPSQ17")
# vcd::mosaic(CESD03 ~ MPSQ17,
#      data = track, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Track: CESD03 vs. MPSQ17")
# 
# dance <- vars_by_sport(df, "Dance", "CESD03", "MPSQ17")
# vcd::mosaic(CESD03 ~ MPSQ17,
#      data = dance, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Dance: CESD03 vs. MPSQ17")
# 
# 
# # depression frequency vs. not letting parents down
# track <- vars_by_sport(df, "Track", "CESD03", "MPSQ19")
# vcd::mosaic(CESD03 ~ MPSQ19,
#      data = track, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Track: CESD03 vs. MPSQ19")
# 
# dance <- vars_by_sport(df, "Dance", "CESD03", "MPSQ19")
# vcd::mosaic(CESD03 ~ MPSQ19,
#      data = dance, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Dance: CESD03 vs. MPSQ19")
# 
# 
# # depression frequency vs. thinking of oneself as the best
# track <- vars_by_sport(df, "Track", "CESD03", "TEOSQ11")
# vcd::mosaic(CESD03 ~ TEOSQ11,
#      data = track, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Track: CESD03 vs. TEOSQ11")
# 
# dance <- vars_by_sport(df, "Dance", "CESD03", "TEOSQ11")
# vcd::mosaic(CESD03 ~ TEOSQ11,
#      data = dance, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Dance: CESD03 vs. TEOSQ11")
# 
# 
# # depression frequency vs. doing one's best
# track <- vars_by_sport(df, "Track", "CESD03", "TEOSQ13")
# vcd::mosaic(CESD03 ~ TEOSQ13,
#      data = track, 
#      direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Track: CESD03 vs. TEOSQ13")
# 
# dance <- vars_by_sport(df, "Dance", "CESD03", "TEOSQ13")
# vcd::mosaic(CESD03 ~ TEOSQ13,
#      data = dance, direction = c("v", "h"),
#      labeling =  labeling_border(rot_labels = c(0, 90, 0, 0)),
#      highlighting_fill = brewer.pal(4, "Blues"),
#      main = "Dance: CESD03 vs. TEOSQ13")

#Track vs. Dance responses to MH questions as pairs mosaic plot
# MH_responses[,c(2:12)] %>% 
#   filter(PSPORT == "Track" | PSPORT == "Dance") %>%
#   table() %>% pairs(space = .2,
#         lower_panel = pairs_mosaic(highlighting = 2, spacing = spacing_equal(0)),
#         upper_panel = pairs_mosaic(spacing = spacing_equal(0)),
#         diag_panel = pairs_barplot(
#           gp_vartext = gpar(fontsize = 8),
#           gp_leveltext = gpar(fontsize = 8),
#           abbreviate = 2))

```

